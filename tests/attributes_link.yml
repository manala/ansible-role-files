---

- name: Attributes - Link - To file
  hosts: all
  gather_facts: false
  pre_tasks:
    - shell: rm -rf /srv/tests/temp/*
    - shell: touch /srv/tests/temp/file
  vars:
    manala_files_attributes:
      - path:  /srv/tests/temp/link
        src:   /srv/tests/temp/file
        state: link
  roles:
    - manala.files
  post_tasks:
    - name: Goss
      raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - file:
            /srv/tests/temp/link:
              exists:    true
              filetype:  symlink
              linked-to: /srv/tests/temp/file

- name: Attributes - Link - To directory
  hosts: all
  gather_facts: false
  pre_tasks:
    - shell: rm -rf /srv/tests/temp/*
    - shell: mkdir /srv/tests/temp/directory
  vars:
    manala_files_attributes:
      - path:  /srv/tests/temp/link
        src:   /srv/tests/temp/directory
        state: link
  roles:
    - manala.files
  post_tasks:
    - name: Goss
      raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - file:
            /srv/tests/temp/link:
              exists:    true
              filetype:  symlink
              linked-to: /srv/tests/temp/directory

- name: Attributes - Link - To link to file
  hosts: all
  gather_facts: false
  pre_tasks:
    - shell: rm -rf /srv/tests/temp/*
    - shell: touch /srv/tests/temp/file
    - shell: ln -s /srv/tests/temp/file /srv/tests/temp/link_file
  vars:
    manala_files_attributes:
      - path:  /srv/tests/temp/link
        src:   /srv/tests/temp/link_file
        state: link
  roles:
    - manala.files
  post_tasks:
    - name: Goss
      raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - file:
            /srv/tests/temp/link:
              exists:    true
              filetype:  symlink
              linked-to: /srv/tests/temp/link_file

- name: Attributes - Link - To link to directory
  hosts: all
  gather_facts: false
  pre_tasks:
    - shell: rm -rf /srv/tests/temp/*
    - shell: mkdir /srv/tests/temp/directory
    - shell: ln -s /srv/tests/temp/directory /srv/tests/temp/link_directory
  vars:
    manala_files_attributes:
      - path:  /srv/tests/temp/link
        src:   /srv/tests/temp/link_directory
        state: link
  roles:
    - manala.files
  post_tasks:
    - name: Goss
      raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - file:
            /srv/tests/temp/link:
              exists:    true
              filetype:  symlink
              linked-to: /srv/tests/temp/link_directory
