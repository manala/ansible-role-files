---

- name: "{{ test }}.1"
  hosts: debian
  become: true
  gather_facts: false
  tasks:
    - block:
        - file:
            path: "{{ item }}"
            state: absent
          loop:
            - /tmp/foo
            - /tmp/bar
            - /tmp/baz
        - import_role:
            name: manala.files
          vars:
            foo: bar
            manala_files_attributes:
              - path: /tmp/foo
                template: fixtures/template.j2
              - path: /tmp/bar
                template: fixtures/template.j2
              - path: /tmp/baz
                template: fixtures/template.j2
                state: present
    - name: Goss
      command: goss --gossfile {{ test }}.goss.1.yml validate
    - block:
        - import_role:
            name: manala.files
          vars:
            foo: bar
            manala_files_attributes:
              - path: /tmp/bar
                template: fixtures/template.j2
                state: absent
    - name: Goss
      command: goss --gossfile {{ test }}.goss.2.yml validate
